generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String?  @unique
  name      String?
  preferences Json   @default("{}")
  createdAt DateTime @default(now()) @map("created_at")

  conversations  Conversation[]
  notes          Note[]
  tasks          Task[]
  goals          Goal[]
  habits         Habit[]
  calendarEvents CalendarEvent[]
  categories     Category[]

  @@map("users")
}

model Conversation {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  title     String?
  createdAt DateTime @default(now()) @map("created_at")

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages Message[]

  @@map("conversations")
}

model Message {
  id             String   @id @default(uuid())
  conversationId String   @map("conversation_id")
  role           String   // 'user' | 'assistant' | 'system'
  content        String
  metadata       Json     @default("{}")
  createdAt      DateTime @default(now()) @map("created_at")

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Note {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  title     String?
  content   String
  category  String?
  tags      String[] @default([])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notes")
}

model Task {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  goalId      String?   @map("goal_id")
  title       String
  description String?
  status      String    @default("pending") // pending | in_progress | completed | cancelled
  priority    String    @default("medium") // low | medium | high | urgent
  dueDate     DateTime? @map("due_date")
  createdAt   DateTime  @default(now()) @map("created_at")

  user User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  goal Goal? @relation(fields: [goalId], references: [id], onDelete: SetNull)

  @@map("tasks")
}

model Goal {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  title       String
  description String?
  status      String    @default("active") // active | completed | archived
  targetDate  DateTime? @map("target_date")
  createdAt   DateTime  @default(now()) @map("created_at")

  user  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  tasks Task[]

  @@map("goals")
}

model Habit {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  name      String
  frequency String   @default("daily") // daily | weekly | custom
  schedule  Json     @default("{}") // For custom schedules
  createdAt DateTime @default(now()) @map("created_at")

  user User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  logs HabitLog[]

  @@map("habits")
}

model HabitLog {
  id         String   @id @default(uuid())
  habitId    String   @map("habit_id")
  loggedDate DateTime @map("logged_date") @db.Date
  completed  Boolean  @default(true)
  notes      String?

  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)

  @@unique([habitId, loggedDate])
  @@map("habit_logs")
}

model CalendarEvent {
  id             String   @id @default(uuid())
  userId         String   @map("user_id")
  title          String
  description    String?
  startTime      DateTime @map("start_time")
  endTime        DateTime @map("end_time")
  recurrenceRule String?  @map("recurrence_rule") // RRULE format
  metadata       Json     @default("{}")
  createdAt      DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("calendar_events")
}

model Category {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  name      String
  type      String // 'note' | 'task' | 'goal'
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name, type])
  @@map("categories")
}
